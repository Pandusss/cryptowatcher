# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OKX WebSocket

OKX WebSocket –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –≤—Ç–æ—Ä–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ü–µ–Ω –ø–æ—Å–ª–µ Binance. –ï—Å–ª–∏ –º–æ–Ω–µ—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ Binance, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OKX.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

1. **OKX WebSocket Worker** (`app/providers/okx_websocket.py`)
   - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `wss://ws.okx.com:8443/ws/v5/public`
   - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–Ω–∞–ª `tickers` –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ
   - –û–±–Ω–æ–≤–ª—è–µ—Ç Redis –∫—ç—à —Å –∫–ª—é—á–∞–º–∏ `coin_price:{coin_id}`

2. **OKX Price Adapter** (`app/providers/okx_price.py`)
   - –ß–∏—Ç–∞–µ—Ç —Ü–µ–Ω—ã –∏–∑ Redis –∫—ç—à–∞ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è WebSocket worker)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç —Å–∏–º–≤–æ–ª–æ–≤ OKX: `BTC-USDT` (—Å –¥–µ—Ñ–∏—Å–æ–º)

3. **Aggregation Service** (`app/services/aggregation_service.py`)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `price_priority` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   - –ï—Å–ª–∏ `price_priority: ["binance", "okx"]`, —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ—Ç Binance, –∑–∞—Ç–µ–º OKX

## –§–æ—Ä–º–∞—Ç —Å–∏–º–≤–æ–ª–æ–≤

- **Binance**: `BTCUSDT` (–±–µ–∑ –¥–µ—Ñ–∏—Å–∞)
- **OKX**: `BTC-USDT` (—Å –¥–µ—Ñ–∏—Å–æ–º)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OKX –∫–∞–∫ fallback, –¥–æ–±–∞–≤—å—Ç–µ –≤ `coins.json`:

```json
{
  "coins": {
    "btc": {
      "id": "btc",
      "name": "Bitcoin",
      "symbol": "BTC",
      "enabled": true,
      "external_ids": {
        "coingecko": "bitcoin",
        "binance": "BTCUSDT",
        "okx": "BTC-USDT"
      },
      "price_priority": ["binance", "okx"]
    }
  }
}
```

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ –ø–æ—Ä—è–¥–∫–µ, —É–∫–∞–∑–∞–Ω–Ω–æ–º –≤ `price_priority`:

1. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Binance)
2. –ï—Å–ª–∏ —Ü–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–±—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π (OKX)
3. –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –ø–æ —Å–ø–∏—Å–∫—É

## –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–Ω–µ—Ç OKX

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–Ω–µ—Ç:

```bash
python scripts/get_okx_coins.py
```

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª—ã:
- `okx_websocket_usdt_symbols.txt` - —Å–ø–∏—Å–æ–∫ USDT –ø–∞—Ä
- `okx_websocket_all_symbols.txt` - –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä—ã
- `okx_websocket_usdt_pairs.json` - –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ JSON

## –ó–∞–ø—É—Å–∫

OKX WebSocket –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`main.py`):

```python
asyncio.create_task(okx_websocket_worker.start())
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

OKX WebSocket –≤—ã–≤–æ–¥–∏—Ç –ª–æ–≥–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```
[OKXWebSocket] üí∞ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ü–µ–Ω: X –º–æ–Ω–µ—Ç –∏–∑ Y —Ç–∏–∫–µ—Ä–æ–≤
[OKXWebSocket] üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: –ø—Ä–æ–ø—É—â–µ–Ω–æ (...)
[OKXWebSocket] üìà –í—Å–µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º: X –º–æ–Ω–µ—Ç | –í OKX: Y | –ù–µ –≤ OKX: Z
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è OKX

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Binance, OKX –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–∏–∫–µ—Ä–æ–≤ –æ–¥–Ω–∏–º –ø–æ—Ç–æ–∫–æ–º (`!ticker@arr`). 
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–∏–∫–µ—Ä –æ—Ç–¥–µ–ª—å–Ω–æ. OKX –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ (–æ–±—ã—á–Ω–æ ~100).

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤—ã–µ 100 —Ç–∏–∫–µ—Ä–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞.

